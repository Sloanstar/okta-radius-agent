#syntax=docker/dockerfile:1
#docker build https://github.com/Sloanstar/okta-radius-agent.git#container:docker-okta-radius-agent-build
FROM ubuntu:focal
EXPOSE 1812/udp
EXPOSE 1813/udp
ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update
RUN apt-get -y install wget sudo debconf-utils
RUN wget https://static.okta.com/static/radius/OktaRadiusAgentSetup-2.15.1.deb -P /var/tmp
RUN dpkg --unpack /var/tmp/OktaRadiusAgentSetup-2.15.1.deb
RUN rm -f /var/tmp/OktaRadiusAgentSetup-2.15.1.deb
RUN sed -i '2 i orgUrl=$OKTA_ORG' /opt/okta/ragent/scripts/configure.sh
RUN sed -i '3 i useProxy=$OKTA_USE_PROXY' /opt/okta/ragent/scripts/configure.sh
RUN sed -i '4 i proxyAddress=$OKTA_PROXY_ADDR' /opt/okta/ragent/scripts/configure.sh
RUN sed -i '5 i proxyUserName=$OKTA_PROXY_USER' /opt/okta/ragent/scripts/configure.sh
RUN sed -i '6 i proxyPassword=$OKTA_PROXY_PASS' /opt/okta/ragent/scripts/configure.sh
ENTRYPOINT ["/usr/bin/bash"]
ENV OKTA_ORG=https://mycompanyorg.okta.com
ENV OKTA_USE_PROXY=No
ENV OKTA_PROXY_ADDR=
ENV OKTA_PROXY_USER=
ENV OKTA_PROXY_PASS=
RUN dpkg --configure ragent
